<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Klamath River Dam Removal</title>

    <style>
      html,
      body {
        height: 100%;
        margin: 0;
      }

      #viewDiv {
        position: absolute;
        right: 0;
        left: 0;
        top: 60px;
        bottom: 0;
      }

      .header {
        position: absolute;
        top: 0;
        width: 100%;
        height: 10%;
      }

      .btns {
        margin: 0 auto;
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        overflow: auto;
      }

      .btn-switch {
        flex-grow: 4;
        background-color: rgba(34, 111, 14, 0.5);
        color: #fff;
        margin: 1px;
        width: 50%;
        padding: 20px;
        overflow: auto;
        text-align: center;
        cursor: pointer;
      }

      .active-map {
        color: #fff;
        background-color: rgba(34, 111, 14, 1);
      }
    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.34/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.34/"></script>

    <script type="module">
      const [MapView, WebMap, Legend] = await $arcgis.import([
        "@arcgis/core/views/MapView.js",
        "@arcgis/core/WebMap.js",
        "@arcgis/core/widgets/Legend",
      ]);

      const webmapids = [
        "9d0108a20e124cb08a9c0852c3fe6e90",
        "b7b3fc93d4804337944cc83a825f3be7",
        "e85658579ee147b68dfc0ca146e5945e",
      ];

      /************************************************************
       * Create multiple WebMap instances
       ************************************************************/
      const webmaps = webmapids.map((webmapid) => {
        return new WebMap({
          portalItem: {
            // autocasts as new PortalItem()
            id: webmapid,
          },
        });
      });

      /************************************************************
       * Initialize the View with the first WebMap
       ************************************************************/
      const view = new MapView({
        map: webmaps[0],
        container: "viewDiv",
        navigation: {
          mouseWheelZoomEnabled: false,
          browserTouchPanEnabled: false,
        },
        popup: {
        dockEnabled: true,
        dockOptions: {
        // Disables the button that allows users to undock the popup
        buttonEnabled: false,
        // Setting breakpoint to false ensures it stays docked on all screen sizes
        breakpoint: false,
        // Position options: "top-left", "top-center", "top-right", 
        // "bottom-left", "bottom-center", "bottom-right"
        position: "top-center"
        }
        },
      });
      view.when(() => {
        const legend = new Legend({
        view: view
        });
    
    view.ui.add(legend, "top-right"); // Adds the legend to the bottom-right of the view
});

      document.querySelector(".btns").addEventListener("click", (event) => {
        /************************************************************
         * On a button click, change the map of the View
         ************************************************************/
        const id = event.target.getAttribute("data-id");
        if (id) {
          const webmap = webmaps[id];
          view.map = webmap;
          const nodes = document.querySelectorAll(".btn-switch");
          for (let idx = 0; idx < nodes.length; idx++) {
            const node = nodes[idx];
            const mapIndex = node.getAttribute("data-id");
            if (mapIndex === id) {
              node.classList.add("active-map");
            } else {
              node.classList.remove("active-map");
            }
          }
        }
      });
    </script>
  </head>

  <body>
    <section class="header esri-widget">
      <div class="btns">
        <div class="btn-switch active-map" data-id="0">Klamath River September 2023</div>
        <div class="btn-switch" data-id="1">Klamath River September 2025</div>
        <div class="btn-switch" data-id="2">Klamath River Septemeber 2025 Revegetation</div>
      </div>
    </section>
    <div id="viewDiv" class="esri-widget"></div>
  </body>
</html>